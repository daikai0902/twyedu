`extends backEndLayout
`set title:" 天唯艺星后台管理"

<div class="row">
	<div class="col-sm-12">
		<div class="table-light table-borrow">
		 	<div class="table-header">
                <div class="table-caption" style="display:inline-block;">
                 学校网点管理
                   <a href="javascript:;" class="btn btn-info" id="btnAddOrganizeGroup" style="margin-left:15px;"> <i class="fa fa-plus"></i> 添加网点</a>
                </div>
            </div>
			<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-page" id="">
				<thead>
					<tr>
						<th style="width:5%">序号</th>
						<th style="width:20%">网点</th>
						<th style="width:20%">操作</th>
					</tr>
				</thead>
				<tbody></tbody>
			</table>
				<div class="table-footer">
                	<div class="div-page"></div>
            	</div>
		</div>
	</div>
</div>


	<div id="modal-add-group" class="modal fade" tabindex="-1" role="dialog" style="display: none;">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h4 class="modal-title" id="myModalLabel">添加网点</h4>
				</div>
				<div class="modal-body form-horizontal">
					<div class="form-group">
						<label class="col-sm-3 control-label text-right">*名称：</label>
						<div class="col-sm-9">
							<input style="width:300px;" type="text" class="form-control" id="groupName" placeholder="请输入网点名称或地点">
						</div>
					</div>
				</div> <!-- / .modal-body -->
				<div class="modal-footer text-center">
					<button type="button" class="btn btn-primary js-add-group">保存</button>
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>

				</div>
			</div> <!-- / .modal-content -->
		</div> <!-- / .modal-dialog -->
	</div>
                
                <div id="modal-edit-group" class="modal fade" tabindex="-1" role="dialog" style="display: none;">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                <h4 class="modal-title" id="myModalLabel">编辑机构</h4>
                            </div>
                            <div class="modal-body form-horizontal">
                            	<div class="form-group">
									<label class="col-sm-3 control-label text-right">机构名称：</label>
									<div class="col-sm-9">
										<input style="width:300px;" type="text" class="form-control" id="groupName-edit" placeholder="机构名称">
									</div>
								</div>
                                <form id="uploadForm" style="display:none">
									<input type="text" name="fileType"   value="image"/>
									<input type="file" name="file" id="uploadify" />
								</form>
								<div class="form-group">
									<label class="col-sm-3 control-label text-right">彩色LOGO：<br><span style="font-size:12px;color:#999;">（透明png格式，<br>宽200px）</span></label>
									<div class="col-sm-9">
										<img style="border:1px solid balck;width:300px;height:100px;cursor: pointer;" alt="上传名称" class="uploadLogo colorLogo-edit"/>
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-3 control-label text-right">白色LOGO：<br><span style="font-size:12px;color:#999;">（透明png格式，<br>宽200px）</span></label>
									<div class="col-sm-9">
										<img  style="border:1px solid balck;width:300px;height:100px;cursor: pointer;" alt="上传名称" class="uploadLogo whiteLogo-edit"/>
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-3 control-label text-right">门户大图：<br><span style="font-size:12px;color:#999;">（透明png格式，<br>宽400px）</span></label>
									<div class="col-sm-9">
										<img  style="border:1px solid balck;width:300px;height:100px;cursor: pointer;" alt="上传名称" class="uploadLogo groupLogo-edit"/>
									</div>
								</div>
								
								<div class="form-group">
									<label class="col-sm-3 control-label text-right">机构介绍：</label>
									<div class="col-sm-9">
										<textarea style="width:300px;height:100px;" class="form-control" id="groupIntro-edit" placeholder="请填写机构介绍"></textarea>
									</div>
								</div>

								<div class="form-group">
									<label class="col-sm-3 control-label text-right">管理员用户名：</label>
									<div class="col-sm-9">
										<input style="width:300px;" type="text" class="form-control" id="editAdminName" placeholder="管理员用户名">
									</div>
								</div>

                            </div>
                            <div class="modal-footer text-center">
                            	<button type="button" class="btn btn-primary js-edit-group">保存</button>
                                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            </div>
                        </div>
                    </div>
                </div>
`set moreJSLink
<script type="text/javascript">
init.push(function () {
	var url = "/edu/back/organizeGroupListData?",
		search = null,
		currentPage = 1,
		editId = null,
		orderType = null;
	
	
	 //分页
    var loadData = function(page){
        var search = $(".input-search").val();
        var tableBody = $(".table-page tbody");

        tableBody.empty();
        
        $.get(url+'&search='+search+'&page='+page,function(res){
            if(res.succ){
                tableBody.append(res.html);
                
                var totalPage = res.totalPage;
                var page = res.page;
                currentPage = page;
                total = totalPage;
                
                initPageDiv(totalPage,page)
            }
        });
    }
    
    addEvent(loadData);
    loadData(currentPage);
    
    $("#btnSearch").on('click', function(){
        loadData(1);
    });
  
    $('#btnAddOrganizeGroup').on('click',function(){
		$("#modal-add-group").modal("show");
	});
    
    $('.pull-right').keydown(function(event){
    	if(event.keyCode == 13){
    		$('#btnSearch').click();
    	}
    });
    
  //新增机构
	$('.js-add-group').click(function(){
		var groupName = $("#groupName").val().trim(),
			//adminEmailOne=$("#adminEmailOne").val().trim(),
			//adminPhoneOne=$("#adminPhoneOne").val().trim(),
			//adminEmailTwo=$("#adminEmailTwo").val().trim(),
			//adminPhoneTwo=$("#adminPhoneTwo").val().trim(),
			adminName=$("#adminName").val().trim(),
			colorLogo = $(".colorLogo").attr("src"),
			whiteLogo = $(".whiteLogo").attr("src"),
			groupLogo = $(".groupLogo").attr("src"),
			groupIntro =$("#groupIntro").val().trim();
		
		if(groupName.length<1){
			$.growl.error({ message: "请输入组织名称！" });
			return;
		}
		if(adminName.length<1){
			$.growl.error({ message: "请输入管理员用户名！" });
			return;
		}

		/*var patrn = /(?!^\d+$)(?!^[a-zA-Z]+$)[0-9a-zA-Z]{6,20}/;
		if (!patrn.test(adminName)){
			$.growl.error({ message: "管理员用户名必须是字母与数字的组合，长度大于6位！" });
			return;
		}*/

		/* if(colorLogo==undefined || colorLogo.length<=0 || whiteLogo==undefined || whiteLogo.length<=0){
			$.growl.error({ message: "请上传图片!" });
			return;
		} */
		$.post('/edu/back/addOrganizeGroup',{
			groupName:groupName,
			colorLogo:colorLogo,
			whiteLogo:whiteLogo,
			adminName:adminName,
			groupIntro:groupIntro,
			groupLogo:groupLogo
		},function(res){
			if(res.succ){
				$("#modal-add-group").modal("hide");
				loadData(1);
			}else{
				$.growl.error({ message:  res.msg });
			}
		})
	})
	
	$('.js-edit-group').click(function(){
		var groupName = $("#groupName-edit").val().trim(),
			colorLogo = $(".colorLogo-edit").attr("src"),
			whiteLogo = $(".whiteLogo-edit").attr("src"),
			adminName=$("#editAdminName").val().trim(),
			groupLogo = $(".groupLogo-edit").attr("src"),
			groupIntro =$("#groupIntro-edit").val().trim();
		
		if(groupName.length<1){
			$.growl.error({ message: "请输入组织名称！" });
			return;
		}
		if(adminName.length<1){
			$.growl.error({ message: "请输入管理员用户名！" });
			return;
		}

		/*var patrn = /(?!^\d+$)(?!^[a-zA-Z]+$)[0-9a-zA-Z]{6,20}/;
		if (!patrn.test(adminName)){
			$.growl.error({ message: "管理员用户名必须是字母与数字的组合，长度大于6位！" });
			return;
		}*/

		/* if(colorLogo==undefined || colorLogo.length<=0 || whiteLogo==undefined || whiteLogo.length<=0){
			$.growl.error({ message: "请上传图片!" });
			return;
		} */
		$.post('/edu/back/editOrganizeGroup',{
			id:editId,
			groupName:groupName,
			colorLogo:colorLogo,
			whiteLogo:whiteLogo,
			adminName:adminName,
			groupIntro:groupIntro,
			groupLogo:groupLogo
		},function(res){
			if(res.succ){
				$("#modal-edit-group").modal("hide");
				loadData(1);
			}else{
				$.growl.error({ message: res.msg });
			}
		})
	})
	
	$('tbody').on('click','.organizeGroup-updateFreeze',function(){
		var _this = $(this);
		var id = _this.attr('data-id');
		var isFreeze = _this.attr('data-isFreeze');
		$.post('/edu/back/updateFreeze',{
			id:id,
			isFreeze:isFreeze
		},function(res){
			if(res.succ){
				loadData(1);
			}else{
				$.growl.error({ message: "机构编辑失败！" });
			}
		});
	});
  
	$('tbody').on('click','.organizeGroup-sort',function(){
		var _this = $(this);
		var id = _this.attr('data-id');
		var sort = _this.attr('data-sort');
		$.post('/edu/back/sortGroup',{
			id:id,
			sort:sort
		},function(res){
			if(res.succ){
				loadData(1);
			}else{
				$.growl.error({ message: "机构排序失败！" });
			}
		});
	});
	
	$('tbody').on('click','.organizeGroup-edit',function(){
		var _this = $(this);
		var id = _this.attr('data-id');
		var tr = _this.parent().parent();
		var name = tr.find('.organizeGroup-groupName').html();
		var colorLogo = _this.attr('data-colorLogo');
		var whiteLogo = _this.attr('data-whiteLogo');
		var adminName = _this.attr('data-admin-name');
		var groupIntro = _this.attr('data-groupIntro');
		var groupLogo = _this.attr('data-groupLogo');
		editId = id;
		$('#groupName-edit').val(name);
		$('.colorLogo-edit').attr('src',colorLogo);
		$('.whiteLogo-edit').attr('src',whiteLogo);
		$('.groupLogo-edit').attr('src',groupLogo);
		$('#editAdminName').val(adminName);
		$("#groupIntro-edit").val(groupIntro);
		$("#modal-edit-group").modal("show");
	});


    $('tbody').on('click','.js-org-classify',function(){
        var groupId = $(this).attr("data-id");
		$.get("/edu/back/jsonOrgTag",{groupId:groupId},function(json){
            layer.open({
                title:'机构分类',
                type:1,
                content:json.html,
                area:['500px','300px'],
                btn:['确定','取消'],
                yes:function(index){
                    var orgTagIds = [];
					$(".js-org-tag").each(function () {
						if($(this).find("option:selected")){
                            orgTagIds.push($(this).find("option:selected").val());
						}
                    })
					if(orgTagIds.length <1){
					    layer.msg("先选择分类");
					    return;
					}
					$.post("/edu/back/addGroupOrgTag",{groupId:groupId,orgTagIds:orgTagIds},function(json){
					    if(json.succ){
					        layer.msg("编辑分类成功！");
					        layer.close(index);
						}
					})
                },
                no:function(index){
                    layer.close(index);
                }
            });
		})

    });
	  
});
window.PixelAdmin.start(init);
</script>
`